<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Scanner</title>
  <!-- build: 2026-01-13-v3 -->
  <style>
    :root { color-scheme: dark; }
    html, body {
      height: 100%;
      margin: 0;
      background: #0b0b0f;
      font-family: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      touch-action: none;
      overflow: hidden;
    }
    .wrap {
      height: 100%;
      display: grid;
      place-items: center;
      padding: env(safe-area-inset-top) env(safe-area-inset-right)
               env(safe-area-inset-bottom) env(safe-area-inset-left);
    }
    .center {
      display: grid;
      place-items: center;
      gap: 18px;
      text-align: center;
    }

    /* Waves: thicker and more visible */
    .waves {
      width: 240px;
      height: 240px;
      position: relative;
      border-radius: 999px;
      display: grid;
      place-items: center;
      filter: drop-shadow(0 0 18px rgba(120, 255, 170, 0.26));
    }
    .dot {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: rgba(120, 255, 170, 0.98);
      box-shadow: 0 0 18px rgba(120, 255, 170, 0.9);
    }
    .ring {
      position: absolute;
      inset: 0;
      border-radius: 999px;
      border: 5px solid rgba(120, 255, 170, 0.58);
      box-shadow: 0 0 22px rgba(120, 255, 170, 0.20) inset;
      transform: scale(0.2);
      opacity: 0;
      animation: ping 2.0s infinite;
    }
    .ring:nth-child(1) { animation-delay: 0.0s; }
    .ring:nth-child(2) { animation-delay: 0.66s; }
    .ring:nth-child(3) { animation-delay: 1.33s; }

    @keyframes ping {
      0%   { transform: scale(0.25); opacity: 0; }
      12%  { opacity: 0.82; }
      100% { transform: scale(1.05); opacity: 0; }
    }

    .label {
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: rgba(255,255,255,0.75);
      font-size: 16px;
    }

    /* Flash: more obvious */
    .flash {
      position: fixed;
      inset: 0;
      pointer-events: none;
      opacity: 0;
      background: rgba(255, 0, 0, 0.0);
    }
    body.alert .flash { animation: flash 0.16s infinite alternate; }
    @keyframes flash { from { opacity: 0.10; } to { opacity: 0.70; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="center">
      <div class="waves" aria-hidden="true">
        <div class="ring"></div>
        <div class="ring"></div>
        <div class="ring"></div>
        <div class="dot"></div>
      </div>
      <div class="label">scanning</div>
    </div>
    <div class="flash"></div>
  </div>

  <script>
    // Behavior:
    // - Alert ON while pressing.
    // - On very quick taps, keep alert ON briefly so it is visible/audible.
    // - Pointer + touch + mouse fallbacks.

    let audioCtx = null;
    let osc = null;
    let gain = null;

    let alertOn = false;
    let pulseIndex = 0;
    let pulseTimeout = null;

    let pressStartMs = 0;
    let stopTimer = null;

    const MIN_ALERT_MS = 450; // ensures quick taps still show/sound

    const pattern = [
      [120, 0.26],
      [90,  0.00],
      [120, 0.26],
      [250, 0.00],
    ];

    function ensureAudio() {
      if (audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      osc = audioCtx.createOscillator();
      gain = audioCtx.createGain();
      osc.type = 'square';
      osc.frequency.value = 750;
      gain.gain.value = 0.0;
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start();
    }

    function setVolume(vol) {
      if (!audioCtx || !gain) return;
      const t = audioCtx.currentTime;
      gain.gain.cancelScheduledValues(t);
      gain.gain.setTargetAtTime(vol, t, 0.01);
    }

    function schedulePulse() {
      if (!alertOn) return;
      const [ms, vol] = pattern[pulseIndex];
      setVolume(vol);
      pulseIndex = (pulseIndex + 1) % pattern.length;
      pulseTimeout = setTimeout(schedulePulse, ms);
    }

    async function startBuzz() {
      ensureAudio();
      if (audioCtx.state !== 'running') {
        try { await audioCtx.resume(); } catch (e) {}
      }
      pulseIndex = 0;
      if (pulseTimeout) clearTimeout(pulseTimeout);
      schedulePulse();
    }

    function stopBuzz() {
      if (pulseTimeout) {
        clearTimeout(pulseTimeout);
        pulseTimeout = null;
      }
      setVolume(0.0);
    }

    function startAlert() {
      if (stopTimer) { clearTimeout(stopTimer); stopTimer = null; }
      if (alertOn) return;
      alertOn = true;
      pressStartMs = Date.now();
      document.body.classList.add('alert');
      startBuzz();
    }

    function stopAlert() {
      if (!alertOn) return;

      const elapsed = Date.now() - pressStartMs;
      const remaining = Math.max(0, MIN_ALERT_MS - elapsed);

      if (stopTimer) { clearTimeout(stopTimer); stopTimer = null; }
      stopTimer = setTimeout(() => {
        alertOn = false;
        document.body.classList.remove('alert');
        stopBuzz();
        stopTimer = null;
      }, remaining);
    }

    // Pointer events
    window.addEventListener('pointerdown', (e) => {
      if (e.pointerType === 'mouse' && e.button !== 0) return;
      startAlert();
    }, { passive: true });

    window.addEventListener('pointerup', stopAlert, { passive: true });
    window.addEventListener('pointercancel', stopAlert, { passive: true });
    window.addEventListener('pointerleave', stopAlert, { passive: true });

    // Touch fallbacks
    window.addEventListener('touchstart', startAlert, { passive: true });
    window.addEventListener('touchend', stopAlert, { passive: true });
    window.addEventListener('touchcancel', stopAlert, { passive: true });

    // Mouse fallbacks
    window.addEventListener('mousedown', (e) => { if (e.button === 0) startAlert(); }, { passive: true });
    window.addEventListener('mouseup', stopAlert, { passive: true });

    // If page is hidden, silence audio
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) stopAlert();
    });
  </script>
</body>
</html>
